import{u as Q}from"./loadingStores-Vol9KwtD.js";import{r as u,p as z,C as W,a as Y,o as a,c as n,b as t,t as l,e as w,d as B,n as F,w as tt,h as A,A as et,v as st,bS as ot,F as J,f as X,u as g,l as at,x as O,y as Z,Z as nt,a2 as I}from"./index-CKXkF7P1.js";import{_ as lt}from"./PaginationComponent-JBs-hEY2.js";import{M as it}from"./bootstrap.esm-FzNOyMo5.js";import{u as k}from"./usePriceToTw-mhH8eMrj.js";const dt={class:"modal-dialog modal-lg"},ct={class:"modal-content border-0"},rt={class:"modal-header bg-dark text-white"},ut={id:"frontMemberModalLabel",class:"modal-title"},_t=["disabled"],mt={class:"modal-body position-relative"},pt={key:0},ht={class:"row d-flex align-items-stretch"},bt={class:"col-lg-6 d-flex flex-column"},ft={class:"table-responsive border border-2 border-dark px-3 mb-3 pt-3"},vt={class:"fs-5 border-bottom border-dark pb-2 mb-3"},xt={class:"table align-middle"},yt=t("td",null,"姓名",-1),gt=t("td",null,"連絡電話",-1),kt=t("td",null,"連絡信箱",-1),wt=t("td",null,"訂購地址",-1),$t=t("td",null,"訂單備註",-1),Ct=t("td",null,"訂單當前狀態",-1),Bt={key:1,class:"text-muted"},Ot=t("td",null,"訂單付款狀態",-1),Tt={key:0,class:"text-success"},Mt={key:1,class:"text-danger"},St={class:"col-lg-6 d-flex flex-column"},At={class:"border border-2 border-dark h-100 px-3 mb-3 pt-3"},Lt={class:"fs-5 border-bottom border-dark pb-2 mb-3"},Nt={class:"d-flex flex-column justify-content-between h-100"},Vt={class:"mb-3"},Et=t("label",{for:"admin-order-select",class:"form-label fw-500"},"修改商品送達狀態",-1),Dt=t("option",{value:"0",selected:""},"未確認",-1),Kt=t("option",{value:"1"},"已確認",-1),Ut=t("option",{value:"2"},"寄送中",-1),jt=t("option",{value:"3"},"已送達",-1),Pt=[Dt,Kt,Ut,jt],Rt={class:"mb-3"},qt=t("label",{for:"admin-order-message",class:"form-label fw-500"},"修改訂單備註",-1),It={class:"form-check"},zt={class:"form-check-labe fw-500",for:"admin-payment-state"},Ft={key:0},Jt={key:1},Xt={class:"d-flex justify-content-end align-items-center pb-2"},Zt=["disabled"],Gt=["disabled"],Ht={key:0},Qt=t("span",{class:"spinner-border spinner-border-sm me-1",role:"status"},[t("span",{class:"visually-hidden"},"儲存中")],-1),Wt=t("span",null,"儲存中",-1),Yt=[Qt,Wt],te={key:1},ee={class:"col-lg-12"},se={class:"table-responsive border-top border-start border-end border-2 border-dark px-3 pt-3"},oe={class:"fs-5 border-bottom border-dark pb-2 mb-3"},ae={class:"table align-middle"},ne=t("thead",null,[t("tr",null,[t("td",null,"品項名稱"),t("td",null,"單價(NT)"),t("td",null,"數量"),t("td",null,"小計(NT)")])],-1),le={key:0},ie={class:"row"},de={class:"col-lg-12"},ce={class:"text-muted text-decoration-line-through"},re={class:"text-danger ps-2"},ue={key:1},_e={class:"border-start border-end border-2 border-dark mb-3"},me={class:"d-flex justify-content-end border-bottom border-2 border-dark pb-12 mb-12 pe-3"},pe={class:"d-flex flex-column align-items-end"},he={class:"fs-5"},be={class:"fw-700"},fe={key:0,class:"text-danger"},ve=t("span",{class:"text-muted"},"*已含運費",-1),xe={key:1,class:"text-center py-64"},ye={__name:"AdminOrderModal",emits:["refetch-articles"],setup(G,{expose:M,emit:r}){const{showAlert:$}=Z(),o=u({}),T=u(!1),h=u([]),m=u(0),b=u(!1),x=u(null),p=u(null),v=r;z(()=>{p.value=new it(x.value,{backdrop:"static",keyboard:!1})}),W(()=>{p.value&&p.value.dispose()});const S=s=>{o.value=JSON.parse(JSON.stringify(s)),h.value=Object.values(s.products||{}),m.value=s.status||0,p.value.show()},y=()=>{p.value.hide()},d=async()=>{try{b.value=!0;const s=`https://vue3-course-api.hexschool.io/v2/api/vue-ben0588/admin/order/${o.value.id}`,e=await O.put(s,{data:{...o.value,status:m.value}});e.data.success&&(y(),$({position:"top-start",title:`成功 | ${e.data.message}`,icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{v("refetch-articles",!0)},1e3))}catch(s){$({title:"失敗",text:`${s.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{b.value=!1}};return M({openModal:S,closeModal:y}),(s,e)=>{var _,f,C,L,N,V,E,D,K,U,j,P,R,q;const i=Y("font-awesome-icon");return a(),n("div",{class:"modal fade",tabindex:"-1","aria-labelledby":"frontMemberModalLabel","aria-hidden":"true",ref_key:"bsAdminOrderModalRef",ref:x},[t("div",dt,[t("div",ct,[t("div",rt,[t("h5",ut," 編輯 - 訂單編碼："+l(o.value.id),1),t("button",{type:"button",class:"bg-dark text-white fs-4 fw-bolder border-0","data-bs-dismiss":"modal","aria-label":"Close",onClick:y,disabled:b.value}," X ",8,_t)]),t("div",mt,[T.value?(a(),n("div",xe,"讀取中，請稍候..")):(a(),n("div",pt,[t("div",ht,[t("div",bt,[t("div",ft,[t("p",vt,[w(i,{icon:["far","address-card"]}),B(" 訂購人資料 ")]),t("table",xt,[t("tbody",null,[t("tr",null,[yt,t("td",null,l((f=(_=o.value)==null?void 0:_.user)==null?void 0:f.name),1)]),t("tr",null,[gt,t("td",null,l((L=(C=o.value)==null?void 0:C.user)==null?void 0:L.tel),1)]),t("tr",null,[kt,t("td",null,l((V=(N=o.value)==null?void 0:N.user)==null?void 0:V.email),1)]),t("tr",null,[wt,t("td",null,l((D=(E=o.value)==null?void 0:E.user)==null?void 0:D.address),1)]),t("tr",null,[$t,t("td",null,l(o.value.message),1)]),t("tr",null,[Ct,t("td",null,[o.value.status?(a(),n("span",{key:0,class:F(`${o.value.status===0?"text-muted":o.value.status===1?"text-dark":o.value.status===2?"text-info":"text-success"}`)},l(o.value.status===0?"未確認":o.value.status===1?"已確認":o.value.status===2?"寄送中":"已送達"),3)):(a(),n("span",Bt,"未確認"))])]),t("tr",null,[Ot,t("td",null,[o.value.is_paid?(a(),n("span",Tt,"已付款")):(a(),n("span",Mt,"未付款"))])])])])])]),t("div",St,[t("div",At,[t("p",Lt,[w(i,{icon:["fas","gear"]}),B(" 訂單操作 ")]),t("form",{class:"h-100 pb-60",onSubmit:tt(d,["prevent"])},[t("div",Nt,[t("div",null,[t("div",Vt,[Et,A(t("select",{class:"form-select","aria-label":"修改送達狀態",id:"admin-order-select","onUpdate:modelValue":e[0]||(e[0]=c=>m.value=c)},Pt,512),[[et,m.value]])]),t("div",Rt,[qt,A(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=c=>o.value.message=c),class:"form-control",id:"admin-order-message"},null,512),[[st,o.value.message]])]),t("div",It,[A(t("input",{class:"form-check-input",type:"checkbox",id:"admin-payment-state","onUpdate:modelValue":e[2]||(e[2]=c=>o.value.is_paid=c)},null,512),[[ot,o.value.is_paid]]),t("label",zt,[B("修改訂單付款狀態"),o.value.is_paid?(a(),n("span",Ft,"(已付款)")):(a(),n("span",Jt,"(未付款)"))])])]),t("div",Xt,[t("button",{type:"button",class:"btn btn-outline-dark w-50",onClick:y,disabled:b.value}," 取消 ",8,Zt),t("button",{type:"submit",class:"btn btn-dark w-50 ms-1",disabled:b.value},[b.value?(a(),n("span",Ht,Yt)):(a(),n("span",te,"儲存"))],8,Gt)])])],32)])]),t("div",ee,[t("div",se,[t("p",oe,[w(i,{icon:["fas","receipt"]}),B(" 訂單詳情 ")]),t("table",ae,[ne,t("tbody",null,[(a(!0),n(J,null,X(o.value.products,(c,H)=>(a(),n("tr",{key:H},[t("td",null,l(c.product.title),1),t("td",null,l(g(k)(c.product.price)),1),t("td",null,l(c.qty),1),c.coupon?(a(),n("td",le,[t("div",ie,[t("div",de,[t("span",ce,l(g(k)(c.total)),1),t("span",re,l(g(k)(c.final_total)),1)])])])):(a(),n("td",ue,l(g(k)(c.final_total)),1))]))),128))])])]),t("div",_e,[t("div",me,[t("div",pe,[t("span",he,[t("span",null," 共 "+l(h.value.length)+" 項商品 | ",1),t("span",be," 合計 NT"+l(g(k)(o.value.total)),1)]),(U=(K=h.value[0])==null?void 0:K.coupon)!=null&&U.title?(a(),n("span",fe,[w(i,{icon:["fas","ticket-simple"]}),B(" 已套用優惠碼："+l((P=(j=h.value[0])==null?void 0:j.coupon)==null?void 0:P.title)+"："+l((q=(R=h.value[0])==null?void 0:R.coupon)==null?void 0:q.code),1)])):at("",!0),ve])])])])])]))])])])],512)}}},ge={class:"pt-3"},ke={class:"row"},we=t("span",{class:"col-6"},[t("h3",{class:""},"訂單列表")],-1),$e={class:"col-6"},Ce={class:"float-end pe-3"},Be={class:"table-responsive"},Oe={class:"table align-middle"},Te=t("thead",null,[t("tr",{class:"fw-500"},[t("td",null,"編碼"),t("td",null,"購買用戶"),t("td",null,"訂單金額(NT)"),t("td",null,"付款狀態"),t("td",null,"寄送狀態"),t("td",null,"操作")])],-1),Me={key:0,class:"flex-center flex-column align-items-start text-success"},Se=t("span",null,"已付款",-1),Ae={key:1,class:"text-dark"},Le={key:0},Ne={key:1,class:"text-muted"},Ve={class:"d-flex align-items-center"},Ee=["onClick"],De=["disabled","onClick"],Ke={key:0},Ue=t("span",{class:"spinner-grow spinner-grow-sm me-1","aria-hidden":"true"},null,-1),je=t("span",{role:"status"},null,-1),Pe=t("span",null,"刪除中",-1),Re=[Ue,je,Pe],qe={key:1},Ze={__name:"AdminOrderView",setup(G){const M=nt(),{showAlert:r}=Z(),$=Q(),o=u(null),T=u([]),h=u([]),m=u(""),b=d=>{o.value.openModal(d)},x="https://vue3-course-api.hexschool.io",p="vue-ben0588",v=async(d=1)=>{try{$.toggleLoading();const s=localStorage.getItem("s72241");O.defaults.headers.common.Authorization=s;const e=`${x}/v2/api/${p}/admin/orders?page=${d}`,i=await O.get(e);T.value=i.data.orders,h.value=i.data.pagination}catch(s){r({title:"失敗",text:`${s.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}).then(e=>{e.isConfirmed&&M.replace("/admin")})}finally{$.toggleLoading()}},S=async d=>{try{const s=`${x}/v2/api/${p}/admin/order/${d}`;r({title:"確認刪除訂單?",text:"注意：確認刪除後，訂單將無法復原!",icon:"question",confirmButtonColor:"#29292D",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,reverseButtons:!0,preConfirm:async()=>{try{return m.value=d,await O.delete(s)}catch(e){return r({title:"失敗",text:`${e.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}),!1}},allowOutsideClick:()=>!I.isLoading()}).then(async e=>{var i,_,f,C;(_=(i=e==null?void 0:e.value)==null?void 0:i.data)!=null&&_.success&&(r({position:"top-start",title:`成功 | ${(C=(f=e==null?void 0:e.value)==null?void 0:f.data)==null?void 0:C.message}`,icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{v()},1e3))})}catch(s){r({title:"失敗",text:`${s.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1})}finally{m.value=""}},y=async()=>{try{const d=`${x}/v2/api/${p}/admin/orders/all`;r({title:"確認刪除全部訂單?",text:"注意：確認刪除後，全部訂單將無法復原!",icon:"question",confirmButtonColor:"#29292D",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,reverseButtons:!0,preConfirm:async()=>{try{return await O.delete(d)}catch(s){return r({title:"失敗",text:`${s.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}),!1}},allowOutsideClick:()=>!I.isLoading()}).then(async s=>{var e,i,_,f;(i=(e=s==null?void 0:s.value)==null?void 0:e.data)!=null&&i.success&&(r({position:"top-start",title:`成功 | ${(f=(_=s==null?void 0:s.value)==null?void 0:_.data)==null?void 0:f.message}`,icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{v()},1e3))})}catch(d){r({title:"失敗",text:`${d.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1})}};return z(()=>{v()}),(d,s)=>(a(),n("div",ge,[t("div",ke,[we,t("span",$e,[t("div",Ce,[t("button",{type:"button",class:"btn btn-outline-danger px-4",onClick:s[0]||(s[0]=e=>y())}," 刪除所有訂單 ")])])]),t("div",Be,[t("table",Oe,[Te,t("tbody",null,[(a(!0),n(J,null,X(T.value,e=>{var i;return a(),n("tr",{key:e.id},[t("td",null,l(e.id),1),t("td",null,l((i=e==null?void 0:e.user)==null?void 0:i.email),1),t("td",null,l(g(k)(e.total)),1),t("td",null,[e.is_paid?(a(),n("div",Me,[Se,t("span",null,l(new Date(e.paid_date*1e3).toISOString().split("T")[0]),1)])):(a(),n("span",Ae,"未付款"))]),t("td",null,[e.status?(a(),n("span",Le,[t("span",{class:F(`${e.status==="0"?"text-muted":e.status==="1"?"text-dark":e.status==="2"?"text-info":"text-success"}`)},l(e.status==="0"?"未確認":e.status==="1"?"已確認":e.status==="2"?"寄送中":"已送達"),3)])):(a(),n("span",Ne,"未確認"))]),t("td",null,[t("div",Ve,[t("button",{type:"button",class:"btn btn-outline-dark me-1",onClick:_=>b(e)}," 編輯 ",8,Ee),t("button",{type:"button",class:"btn btn-outline-danger",disabled:m.value===e.id,onClick:_=>S(e.id)},[m.value===e.id?(a(),n("span",Ke,Re)):(a(),n("span",qe," 刪除 "))],8,De)])])])}),128))])])]),w(lt,{pagination:h.value,"onUpdated:page":v},null,8,["pagination"]),w(ye,{ref_key:"adminOrderModal",ref:o,onRefetchOrders:v},null,512)]))}};export{Ze as default};

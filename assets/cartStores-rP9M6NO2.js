import{Y as k,r,p as T,z as l,a0 as B,A as O}from"./index-vmlNiwhE.js";import{u as b}from"./useToast-vTYsJrIh.js";const f="https://vue3-course-api.hexschool.io",d="vue-ben0588",{showAlert:s}=O(),{toastAlert:u}=b(),K=k("cartStores",()=>{const w=r([]),h=r(0),C=r(0),m=r(!1),i=r(""),p=r(!1),n=async()=>{try{m.value=!0;const e=`${f}/v2/api/${d}/cart`,t=await l.get(e);w.value=t.data.data.carts,h.value=t.data.data.final_total,C.value=t.data.data.total}catch(e){s({title:`${e}`,text:"取得購物車資訊失敗，請聯繫網站提供者",icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{m.value=!1}},g=async({id:e,quantity:t})=>{try{i.value=e;const a=`${f}/v2/api/${d}/cart`,o=await l.post(a,{data:{product_id:e,qty:t}});o.data.success&&(u({message:`<img src="https://cdn-icons-gif.flaticon.com/7920/7920939.gif" class="success-icon"/><a href="https://www.flaticon.com/free-animated-icons/tick" title="tick animated icons" class="d-none">Tick animated icons created by Freepik - Flaticon</a> ${o.data.message}`,transition:"slide"}),i.value="",await n())}catch(a){s({title:"失敗!",text:`${a}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{i.value=""}},v=async({id:e,productId:t,quantity:a})=>{try{p.value=!0;const o=`${f}/v2/api/${d}/cart/${e}`,c=await l.put(o,{data:{product_id:t,qty:a}});c.data.success&&(u({message:`<img src="https://cdn-icons-gif.flaticon.com/7211/7211795.gif" class="success-icon"/><a href="https://www.flaticon.com/free-animated-icons/refresh" title="refresh animated icons" class="d-none">Refresh animated icons created by Freepik - Flaticon</a> ${c.data.message}`,transition:"slide"}),i.value="",await n())}catch(o){s({title:"失敗!",text:`${o}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{i.value="",p.value=!1}},x=async e=>{try{const t=`${f}/v2/api/${d}/cart/${e}`;s({title:"移除此商品?",text:"確認後此商品項目將會被移除",icon:"question",confirmButtonColor:"#d63031",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,reverseButtons:!1,preConfirm:async()=>{try{return await l.delete(t)}catch(a){return s({title:"失敗",text:`${a.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}),!1}},allowOutsideClick:()=>!B.Swal.isLoading()}).then(async a=>{var o,c,y;(c=(o=a==null?void 0:a.value)==null?void 0:o.data)!=null&&c.success&&(u({message:`<img src="https://cdn-icons-gif.flaticon.com/7920/7920939.gif" class="success-icon"/><a href="https://www.flaticon.com/free-animated-icons/tick" title="tick animated icons" class="d-none">Tick animated icons created by Freepik - Flaticon</a> ${(y=a==null?void 0:a.value)==null?void 0:y.data.message}`,transition:"slide"}),await n())})}catch(t){s({title:"失敗!",text:`${t}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}},$=async()=>{try{const e=`${f}/v2/api/${d}/carts`;s({title:"移除所有商品?",text:"確認後所有商品項目將會被移除",icon:"question",confirmButtonColor:"#d63031",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,reverseButtons:!1,preConfirm:async()=>{try{return await l.delete(e)}catch(t){return s({title:"失敗",text:`${t.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}),!1}},allowOutsideClick:()=>!B.Swal.isLoading()}).then(async t=>{var a,o,c;(o=(a=t==null?void 0:t.value)==null?void 0:a.data)!=null&&o.success&&(u({message:`<img src="https://cdn-icons-gif.flaticon.com/7920/7920939.gif" class="success-icon"/><a href="https://www.flaticon.com/free-animated-icons/tick" title="tick animated icons" class="d-none">Tick animated icons created by Freepik - Flaticon</a> ${(c=t==null?void 0:t.value)==null?void 0:c.data.message}`,transition:"slide"}),await n())})}catch(e){s({title:"失敗!",text:`${e}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}};return T(()=>{n()}),{addTargetId:i,editState:p,cartLoading:m,cartList:w,cartFinalTotal:h,cartTotal:C,fetchCarts:n,addCart:g,editCart:v,deleteCart:x,deleteCarts:$}});export{K as u};

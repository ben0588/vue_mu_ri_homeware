import{u as ne}from"./loadingStores-VtGRsxYi.js";import{r as n,c4 as re,b8 as ce,_ as de,c5 as ue,$ as k,c9 as z,ca as me,z as pe,p as H,C as _e,o as s,c as a,b as e,t as b,u as i,e as _,n as K,l as O,d as Q,x as B,y as W,Z as he,F as X,f as Z,a2 as fe}from"./index-fB0EJXL3.js";import{_ as be}from"./PaginationComponent-Qbpra8k5.js";import{M as ve}from"./bootstrap.esm-FzNOyMo5.js";import{_ as M,C as ge,a as G,b as ye}from"./VeeValidateCustomCheckbox-xqvzNh96.js";const $e={class:"modal-dialog modal-xl"},xe={class:"modal-content border-0"},we={class:"modal-header bg-dark text-white"},Ce={id:"adminArticleModalLabel",class:"modal-title"},ke={key:0},Be={key:1},Te=["disabled"],Ae={class:"modal-body position-relative"},Ue={key:0},Se={class:"row"},qe={class:"col-md-4"},Me={class:"input-group mb-3"},Oe=e("label",{for:"imageUrlFile",class:"form-label w-100"},"或 上傳主圖片 ( 限jpg/jpeg/png )",-1),Le=["disabled","title"],Ve={key:0},Fe=e("span",{class:"spinner-border spinner-border-sm me-1",role:"status"},[e("span",{class:"visually-hidden"},"上傳中")],-1),Ne=e("span",null,"上傳中",-1),Ee=[Fe,Ne],Pe={key:1},Re={key:0,class:"text-danger"},Je={key:0},je=e("h5",{class:"mb-1 mt-2"},"主圖片預覽",-1),De=["src","alt"],Ie={key:1},ze=e("h5",{class:"mb-1 mt-2"},"文章副圖片 [1] 預覽",-1),Ke=["src","alt"],Xe={key:2},Ze=e("h5",{class:"mb-1 mt-2"},"文章副圖片 [2] 預覽",-1),Ge=["src","alt"],He={class:"col-md-8"},Qe={class:"row"},We={class:"col-md-6"},Ye={class:"col-md-6"},et={class:"col-md-6"},tt={class:"col-md-6"},st=e("label",{for:"admin-article-tag",class:"form-label fs-6"},[e("span",{class:"text-danger"},"*"),Q("請選擇文章標籤 (可多選)")],-1),at={key:0,class:"text-danger"},lt={class:"col-12"},ot={class:"col-12"},it={class:"col-12"},nt={class:"modal-footer mt-3"},rt=["disabled"],ct={key:0},dt=e("span",{class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},null,-1),ut=e("span",{role:"status"},null,-1),mt={key:1},pt={key:1,class:"text-center py-64"},_t={__name:"AdminArticleModal",emits:["refetch-articles"],setup(Y,{expose:J,emit:w}){const T="https://vue3-course-api.hexschool.io",A="vue-ben0588",{showAlert:v}=W(),f=n(""),g=n(""),U=n(!1),y=n(!1),F=["客廳","廚房","臥室","書房","浴室"],u=n([]),N=n(null),m=n(null),d=w,t=n({title:"",subtitle:"",description:"",image:"",imagesUrl:["",""],tag:[],create_at:0,author:"小白",isPublic:!0,content:""}),{setFieldValue:p,values:r,errors:S,handleSubmit:E,meta:j,resetForm:D}=re({initialValues:JSON.parse(JSON.stringify(t.value)),validationSchema:ce(de().shape({create_at:ue(),title:k().required("此欄位必填"),subtitle:k().required("此欄位必填"),image:k().required("此欄位必填").matches(/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\\/~+#-]*[\w@?^=%&amp;\\/~+#-])?/,{message:"URL 必須以 https:// 開頭",excludeEmptyString:!0}),imagesUrl:z().of(k().required("此欄位必填").matches(/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\\/~+#-]*[\w@?^=%&amp;\\/~+#-])?/,{message:"URL 必須以 https:// 開頭",excludeEmptyString:!0})),author:k().required("此欄位必填"),tag:z().min(1,"至少需要一個標籤").required("此欄位必填"),content:k().required("此欄位必填"),description:k().required("此欄位必填"),isPublic:me().required("此欄位必填")}))});pe(()=>u.value,()=>{p("tag",JSON.parse(JSON.stringify(u.value)))}),H(()=>{m.value=new ve(N.value,{backdrop:"static",keyboard:!1})}),_e(()=>{m.value&&m.value.dispose()});const ee=async c=>{try{U.value=!0;const l=`https://vue3-course-api.hexschool.io/v2/api/vue-ben0588/admin/article/${c}`,o=await B.get(l);D({values:o.data.article}),u.value=o.data.article.tag}catch(l){v({title:"失敗",text:`${l.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{U.value=!1}},te=({id:c,type:l})=>{g.value=l||"",f.value=c||"",u.value=[],l==="create"?g.value=l:l==="edit"&&ee(c),m.value.show()},P=()=>{D({values:JSON.parse(JSON.stringify(t.value))}),u.value=[],m.value.hide()},se=async c=>{try{y.value=!0;const l=f.value?"儲存":"新增";let o,$;l==="新增"?(o=`${T}/v2/api/${A}/admin/article`,$=await B.post(o,{data:{...c,create_at:Math.floor(new Date().getTime()/1e3)}})):l==="儲存"&&(o=`${T}/v2/api/${A}/admin/article/${f.value}`,$=await B.put(o,{data:{...c}})),$.data.success&&(P(),v({position:"top-start",title:`成功 | ${$.data.message}`,icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{d("refetch-articles",!0)},1e3))}catch(l){v({title:"失敗",text:`${l.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{u.value=[],y.value=!1}},I=E(c=>{se(c)}),h=n(null),C=n(!1),L=n(""),R=n(!1),ae=c=>{var o;R.value=!0;const{files:l}=c.target;if(h.value=l,(o=h.value[0])!=null&&o.name){const V=/\.(jpg|png|jpeg)$/.test(h.value[0].name),x=3*1024*1024;V?(L.value="",h.value[0].size>x&&(L.value="檔案大小限制為 3MB 以下，請重新選擇")):V||(R.value=!1,L.value="限制只能上傳 .jpg、.jpeg  或 .png 格式圖片")}},le=async()=>{var c,l,o,$,V;try{if(C.value=!0,h.value.files){const x=new FormData;x.append("file-to-upload",(c=h==null?void 0:h.value)==null?void 0:c.files[0]);const oe=`${T}/v2/api/${A}/admin/upload`,ie={"Content-Type":"multipart/form-data"},q=await B.post(oe,x,{headers:ie});(l=q==null?void 0:q.data)!=null&&l.success&&(p("image",(o=q==null?void 0:q.data)==null?void 0:o.imageUrl),h.value&&(h.value.value=""),C.value=!1,v({position:"top-start",title:"成功 | 圖片上傳成功",icon:"success",showConfirmButton:!1,timer:1e3}))}}catch(x){v({title:`失敗 | ${(V=($=x==null?void 0:x.response)==null?void 0:$.data)==null?void 0:V.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000"})}finally{C.value=!1}};return J({openModal:te,closeModal:P}),(c,l)=>(s(),a("div",{class:"modal fade",tabindex:"-1","aria-labelledby":"adminArticleModalLabel","aria-hidden":"true",ref_key:"bsAdminArticleModalRef",ref:N},[e("div",$e,[e("div",xe,[e("div",we,[e("h5",Ce,[g.value==="create"?(s(),a("span",ke,"新增文章")):(s(),a("span",Be,"編輯文章 - 文章編碼："+b(f.value),1))]),e("button",{type:"button",class:"bg-dark text-white fs-4 fw-bolder border-0","data-bs-dismiss":"modal","aria-label":"Close",onClick:P,disabled:y.value}," X ",8,Te)]),e("div",Ae,[U.value?(s(),a("div",pt,"讀取中，請稍候..")):(s(),a("div",Ue,[e("form",{onSubmit:l[1]||(l[1]=(...o)=>i(I)&&i(I)(...o))},[e("div",Se,[e("div",qe,[_(M,{name:"image",id:"admin-article-image",required:!0,labelText:"文章主圖片網址(URL)",labelClass:"fs-6"}),e("div",Me,[Oe,e("input",{class:"form-control",type:"file",name:"file-to-upload",id:"imageUrlFile",ref_key:"fileRef",ref:h,onChange:ae},null,544),e("button",{class:K(["input-group-text d-block bg-dark text-white w-100",{"btn-secondary":C.value,"text-dark":C.value}]),type:"button",onClick:le,disabled:!R.value||C.value,title:R.value?"上傳檔案":"請先選擇檔案"},[C.value?(s(),a("span",Ve,Ee)):(s(),a("span",Pe," 上傳圖片"))],10,Le),L.value?(s(),a("span",Re,"*"+b(L.value),1)):O("",!0)]),_(M,{name:"imagesUrl[0]",id:"admin-article-imagesUrl-0",required:!0,labelText:"文章副圖片網址(URL)",inputContainer:"mb-1",labelClass:"fs-6"}),_(M,{name:"imagesUrl[1]",id:"admin-article-imagesUrl-1",required:!0,labelText:"",labelClass:"d-none"}),i(r).image.match(/^https:\/\//)?(s(),a("div",Je,[je,e("img",{class:"img-fluid border border-2",src:i(r).image,alt:i(r).title},null,8,De)])):O("",!0),i(r).imagesUrl[0].match(/^https:\/\//)?(s(),a("div",Ie,[ze,e("img",{class:"img-fluid border border-2",src:i(r).imagesUrl[0],alt:i(r).title},null,8,Ke)])):O("",!0),i(r).imagesUrl[1].match(/^https:\/\//)?(s(),a("div",Xe,[Ze,e("img",{class:"img-fluid border border-2",src:i(r).imagesUrl[1],alt:i(r).title},null,8,Ge)])):O("",!0)]),e("div",He,[e("div",Qe,[e("div",We,[_(M,{name:"title",id:"admin-article-title",required:!0,labelText:"文章主標題",labelClass:"fs-6"})]),e("div",Ye,[_(M,{name:"subtitle",id:"admin-article-subtitle",required:!0,labelText:"文章副標題",labelClass:"fs-6"})]),e("div",et,[_(M,{name:"author",id:"admin-article-author",required:!0,labelText:"文章作者",labelClass:"fs-6"})]),e("div",tt,[st,_(i(ge),{options:F,clearable:!1,modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=o=>u.value=o),multiple:"",class:K(["style-chooser",`${i(S).tag&&i(j).touched&&"border-danger-important"}`]),id:"admin-article-tag"},null,8,["modelValue","class"]),i(S).tag&&i(j).touched?(s(),a("span",at,b(i(S).tag),1)):O("",!0)]),e("div",lt,[_(G,{name:"description",id:"admin-article-description",required:!0,labelText:"主標題內容",labelClass:"fs-6",inputContainer:"mt-3"})]),e("div",ot,[_(G,{name:"content",id:"admin-article-center",required:!0,labelText:"副標題內容",labelClass:"fs-6",inputContainer:"mt-3"})]),e("div",it,[_(ye,{name:"isPublic",id:"admin-article-isPublic",labelText:"文章開啟狀態",labelClass:"fs-6",inputContainer:"mt-3"})])])])]),e("div",nt,[e("button",{type:"button",class:"btn btn-outline-secondary text-dark",onClick:P}," 取消 "),e("button",{type:"submit",class:"btn btn-primary text-white px-5",disabled:y.value},[y.value?(s(),a("span",ct,[dt,ut,e("span",null,b(f.value?"儲存中":"新增中"),1)])):(s(),a("span",mt,b(f.value?"儲存":"新增"),1))],8,rt)])],32)]))])])])],512))}},ht={class:"pt-3"},ft={class:"row"},bt=e("span",{class:"col-6"},[e("h3",{class:""},"文章列表")],-1),vt={class:"col-6"},gt={class:"float-end pe-3"},yt={class:"table-responsive"},$t={class:"table align-middle"},xt=e("thead",null,[e("tr",{class:"fw-500"},[e("td",null,"編碼"),e("td",null,"主標題"),e("td",null,"建立日期"),e("td",null,"標籤"),e("td",null,"狀態"),e("td",null,"操作")])],-1),wt={key:0},Ct={key:0,class:"text-success"},kt={key:1,class:"text-danger"},Bt={class:"d-flex align-items-center"},Tt=["onClick"],At=["disabled","onClick"],Ut={key:0},St=e("span",{class:"spinner-grow spinner-grow-sm me-1","aria-hidden":"true"},null,-1),qt=e("span",{role:"status"},null,-1),Mt=e("span",null,"刪除中",-1),Ot=[St,qt,Mt],Lt={key:1},Rt={__name:"AdminArticlesView",setup(Y){const J=he(),{showAlert:w}=W(),T=ne(),A=n(null),v=n([]),f=n([]),g=n(""),U=({type:m,id:d})=>{A.value.openModal({type:m,id:d})},y="https://vue3-course-api.hexschool.io",F="vue-ben0588",u=async(m=1)=>{try{T.toggleLoading();const d=localStorage.getItem("s72241");B.defaults.headers.common.Authorization=d;const t=`${y}/v2/api/${F}/admin/articles?page=${m}`,p=await B.get(t);v.value=p.data.articles,f.value=p.data.pagination}catch(d){w({title:"失敗",text:`${d.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}).then(t=>{t.isConfirmed&&J.replace("/admin")})}finally{T.toggleLoading()}},N=async m=>{try{const d=`${y}/v2/api/${F}/admin/article/${m}`;w({title:"確認刪除訂單?",text:"注意：確認刪除後，訂單將無法復原!",icon:"question",confirmButtonColor:"#29292D",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,reverseButtons:!0,preConfirm:async()=>{try{return g.value=m,await B.delete(d)}catch(t){return w({title:"失敗",text:`${t.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}),!1}},allowOutsideClick:()=>!fe.isLoading()}).then(async t=>{var p,r,S,E;(r=(p=t==null?void 0:t.value)==null?void 0:p.data)!=null&&r.success&&(w({position:"top-start",title:`成功 | ${(E=(S=t==null?void 0:t.value)==null?void 0:S.data)==null?void 0:E.message}`,icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{u()},1e3))})}catch(d){w({title:"失敗",text:`${d.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1})}finally{g.value=""}};return H(()=>{u()}),(m,d)=>(s(),a("div",ht,[e("div",ft,[bt,e("span",vt,[e("div",gt,[e("button",{type:"button",class:"btn btn-success px-4",onClick:d[0]||(d[0]=t=>U({type:"create"}))}," 新增文章 ")])])]),e("div",yt,[e("table",$t,[xt,e("tbody",null,[(s(!0),a(X,null,Z(v.value,t=>(s(),a("tr",{key:t.id},[e("td",null,b(t.id),1),e("td",null,b(t.title),1),e("td",null,b(new Date(t.create_at*1e3).toISOString().split("T")[0]),1),e("td",null,[(s(!0),a(X,null,Z(t.tag,(p,r)=>(s(),a("span",{key:r,class:""},[Q(b(p),1),r<t.tag.length-1?(s(),a("span",wt,"、")):O("",!0)]))),128))]),e("td",null,[t.isPublic?(s(),a("span",Ct," 啟用 ")):(s(),a("span",kt,"未啟用"))]),e("td",null,[e("div",Bt,[e("button",{type:"button",class:"btn btn-outline-dark me-1",onClick:p=>U({type:"edit",id:t.id})}," 編輯 ",8,Tt),e("button",{type:"button",class:"btn btn-outline-danger",disabled:g.value===t.id,onClick:p=>N(t.id)},[g.value===t.id?(s(),a("span",Ut,Ot)):(s(),a("span",Lt," 刪除 "))],8,At)])])]))),128))])])]),_(be,{pagination:f.value,"onUpdated:page":u},null,8,["pagination"]),_(_t,{ref_key:"adminArticleModal",ref:A,onRefetchArticles:u},null,512)]))}};export{Rt as default};

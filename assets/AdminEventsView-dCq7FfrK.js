import{u as W}from"./loadingStores-H5rSrE_3.js";import{r as d,c4 as Y,b8 as ee,_ as te,c5 as se,$ as U,c9 as ae,ca as oe,p as J,C as le,o as s,c as a,b as e,t as E,u as r,e as v,n as ne,l as B,x as S,y as K,Z as ie,F as re,f as ce,a2 as de}from"./index-dUpJ6sVg.js";import{M as ue}from"./bootstrap.esm-FzNOyMo5.js";import{_ as T,a as V,b as me}from"./VeeValidateCustomCheckbox-pD_Q5-Tq.js";const _e={class:"modal-dialog modal-xl"},pe={class:"modal-content border-0"},he={class:"modal-header bg-dark text-white"},ve={id:"adminEventModalLabel",class:"modal-title"},fe={key:0},be={key:1},ge=["disabled"],ye={class:"modal-body position-relative"},we={key:0},xe={class:"row"},Ce={class:"col-md-4"},$e={class:"input-group mb-3"},ke=e("label",{for:"imageUrlFile",class:"form-label w-100"},"或 上傳主圖片 ( 限jpg/jpeg/png )",-1),Ue=["disabled","title"],Be={key:0},Te=e("span",{class:"spinner-border spinner-border-sm me-1",role:"status"},[e("span",{class:"visually-hidden"},"上傳中")],-1),Ee=e("span",null,"上傳中",-1),Se=[Te,Ee],qe={key:1},Me={key:0,class:"text-danger"},Le={key:0},Oe=e("h5",{class:"mb-1 mt-2"},"主圖片預覽",-1),Ae=["src","alt"],je={key:1},Fe={key:0},Re=e("h5",{class:"mb-1 mt-2"},"文章副圖片 [1] 預覽",-1),De=["src","alt"],Ne={key:1},Pe=e("h5",{class:"mb-1 mt-2"},"文章副圖片 [2] 預覽",-1),Ve=["src","alt"],Je={key:2},Ke=e("h5",{class:"mb-1 mt-2"},"文章副圖片 [3] 預覽",-1),Ie=["src","alt"],ze={class:"col-md-8"},Xe={class:"row"},Ze={class:"col-md-6"},Ge={class:"col-md-6"},He={class:"col-12"},Qe={class:"col-12"},We={class:"col-12"},Ye={class:"modal-footer mt-3"},et=["disabled"],tt={key:0},st=e("span",{class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},null,-1),at=e("span",{role:"status"},null,-1),ot={key:1},lt={key:1,class:"text-center py-64"},nt={__name:"AdminEventModal",emits:["refetch-events"],setup(I,{expose:D,emit:y}){const M="https://vue3-course-api.hexschool.io",L="vue-ben0588",{showAlert:f}=K(),m=d(""),k=d(""),w=d(!1),x=d(!1),h=d(null),t=d(null),c=y,C=d({id:new Date().getTime(),create_at:0,title:"",subtitle:"",description:"",content:"",imageUrl:"",imagesUrl:["","",""],ActivityTime:"",isPublic:!0}),{setFieldValue:O,values:l,handleSubmit:z,resetForm:N}=Y({initialValues:JSON.parse(JSON.stringify(C.value)),validationSchema:ee(te().shape({create_at:se(),title:U().required("此欄位必填"),subtitle:U().required("此欄位必填"),imageUrl:U().required("此欄位必填").matches(/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\\/~+#-]*[\w@?^=%&amp;\\/~+#-])?/,{message:"URL 必須以 https:// 開頭",excludeEmptyString:!0}),imagesUrl:ae().of(U().required("此欄位必填").matches(/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\\/~+#-]*[\w@?^=%&amp;\\/~+#-])?/,{message:"URL 必須以 https:// 開頭",excludeEmptyString:!0})),content:U().required("此欄位必填"),description:U().required("此欄位必填"),isPublic:oe().required("此欄位必填")}))});J(()=>{t.value=new ue(h.value,{backdrop:"static",keyboard:!1})}),le(()=>{t.value&&t.value.dispose()});const X=async n=>{try{w.value=!0;const o=`https://vue-mu-ri-homeware-json-server.onrender.com/events?id=${n}`,i=await S.get(o),[u]=i.data;N({values:u})}catch{f({title:"失敗",icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{w.value=!1}},Z=({id:n,type:o})=>{k.value=o||"",m.value=n||"",o==="create"?k.value=o:o==="edit"&&X(n),t.value.show()},A=()=>{N({values:JSON.parse(JSON.stringify(C.value))}),t.value.hide()},G=async n=>{try{x.value=!0;const o=m.value?"儲存":"新增";let i,u;o==="新增"?(i="https://vue-mu-ri-homeware-json-server.onrender.com/events",u=await S.post(i,{data:{...n,id:new Date().getTime(),create_at:Math.floor(new Date().getTime()/1e3)}})):o==="儲存"&&(i=`https://vue-mu-ri-homeware-json-server.onrender.com/events/${m.value}`,u=await S.put(i,{data:{...n}})),u.status===200&&(A(),f({position:"top-start",title:`成功 | ${u.data.message}`,icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{c("refetch-events",!0)},1e3))}catch(o){f({title:"失敗",text:`${o.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{x.value=!1}},P=z(n=>{G(n)}),_=d(null),$=d(!1),q=d(""),j=d(!1),H=n=>{var i;j.value=!0;const{files:o}=n.target;if(_.value=o,(i=_.value[0])!=null&&i.name){const b=/\.(jpg|png|jpeg)$/.test(_.value[0].name),p=3*1024*1024;b?(q.value="",_.value[0].size>p&&(q.value="檔案大小限制為 3MB 以下，請重新選擇")):b||(j.value=!1,q.value="限制只能上傳 .jpg、.jpeg  或 .png 格式圖片")}},Q=async()=>{var n,o,i,u,b;try{if($.value=!0,_.value.files){const p=new FormData;p.append("file-to-upload",(n=_==null?void 0:_.value)==null?void 0:n.files[0]);const F=`${M}/v2/api/${L}/admin/upload`,R={"Content-Type":"multipart/form-data"},g=await S.post(F,p,{headers:R});(o=g==null?void 0:g.data)!=null&&o.success&&(O("image",(i=g==null?void 0:g.data)==null?void 0:i.imageUrl),_.value&&(_.value.value=""),$.value=!1,f({position:"top-start",title:"成功 | 圖片上傳成功",icon:"success",showConfirmButton:!1,timer:1e3}))}}catch(p){f({title:`失敗 | ${(b=(u=p==null?void 0:p.response)==null?void 0:u.data)==null?void 0:b.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000"})}finally{$.value=!1}};return D({openModal:Z,closeModal:A}),(n,o)=>{var i,u,b,p,F,R;return s(),a("div",{class:"modal fade",tabindex:"-1","aria-labelledby":"adminEventModalLabel","aria-hidden":"true",ref_key:"bsAdminEventModalRef",ref:h},[e("div",_e,[e("div",pe,[e("div",he,[e("h5",ve,[k.value==="create"?(s(),a("span",fe,"新增文章")):(s(),a("span",be,"編輯文章 - 文章編碼："+E(m.value),1))]),e("button",{type:"button",class:"bg-dark text-white fs-4 fw-bolder border-0","data-bs-dismiss":"modal","aria-label":"Close",onClick:A,disabled:x.value}," X ",8,ge)]),e("div",ye,[w.value?(s(),a("div",lt,"讀取中，請稍候..")):(s(),a("div",we,[e("form",{onSubmit:o[0]||(o[0]=(...g)=>r(P)&&r(P)(...g))},[e("div",xe,[e("div",Ce,[v(T,{name:"imageUrl",id:"admin-event-image",required:!0,labelText:"文章封面圖片網址(URL)",labelClass:"fs-6"}),e("div",$e,[ke,e("input",{class:"form-control",type:"file",name:"file-to-upload",id:"imageUrlFile",ref_key:"fileRef",ref:_,onChange:H},null,544),e("button",{class:ne(["input-group-text d-block bg-dark text-white w-100",{"btn-secondary":$.value,"text-dark":$.value}]),type:"button",onClick:Q,disabled:!j.value||$.value,title:j.value?"上傳檔案":"請先選擇檔案"},[$.value?(s(),a("span",Be,Se)):(s(),a("span",qe," 上傳圖片"))],10,Ue),q.value?(s(),a("span",Me,"*"+E(q.value),1)):B("",!0)]),v(T,{name:"imagesUrl[0]",id:"admin-event-imagesUrl-0",required:!0,labelText:"文章副圖片網址(URL) [橫、直、直]",inputContainer:"mb-1",labelClass:"fs-6"}),v(T,{name:"imagesUrl[1]",id:"admin-event-imagesUrl-1",required:!0,labelText:"",labelClass:"d-none",inputContainer:"mb-1"}),v(T,{name:"imagesUrl[2]",id:"admin-event-imagesUrl-2",required:!0,labelText:"",labelClass:"d-none"}),r(l).imageUrl.match(/^https:\/\//)?(s(),a("div",Le,[Oe,e("img",{class:"img-fluid border border-2",src:r(l).imageUrl,alt:r(l).title},null,8,Ae)])):B("",!0),(i=r(l))!=null&&i.imagesUrl?(s(),a("div",je,[(u=r(l))!=null&&u.imagesUrl[0].match(/^https:\/\//)?(s(),a("div",Fe,[Re,e("img",{class:"img-fluid border border-2",src:r(l).imagesUrl[0],alt:r(l).title},null,8,De)])):B("",!0),(p=(b=r(l))==null?void 0:b.imagesUrl[1])!=null&&p.match(/^https:\/\//)?(s(),a("div",Ne,[Pe,e("img",{class:"img-fluid border border-2",src:r(l).imagesUrl[1],alt:r(l).title},null,8,Ve)])):B("",!0),(R=(F=r(l))==null?void 0:F.imagesUrl[2])!=null&&R.match(/^https:\/\//)?(s(),a("div",Je,[Ke,e("img",{class:"img-fluid border border-2",src:r(l).imagesUrl[2],alt:r(l).title},null,8,Ie)])):B("",!0)])):B("",!0)]),e("div",ze,[e("div",Xe,[e("div",Ze,[v(T,{name:"title",id:"admin-event-title",required:!0,labelText:"活動主標題",labelClass:"fs-6"})]),e("div",Ge,[v(T,{name:"subtitle",id:"admin-event-subtitle",required:!0,labelText:"活動副標題",labelClass:"fs-6"})]),e("div",He,[v(V,{name:"description",id:"admin-event-description",required:!0,labelText:"主標題內容",labelClass:"fs-6",inputContainer:"mt-3"})]),e("div",Qe,[v(V,{name:"content",id:"admin-event-center",required:!0,labelText:"副標題內容",labelClass:"fs-6",inputContainer:"mt-3"})]),e("div",We,[v(me,{name:"isPublic",id:"admin-event-isPublic",labelText:"活動開啟狀態",labelClass:"fs-6",inputContainer:"mt-3"})])])])]),e("div",Ye,[e("button",{type:"button",class:"btn btn-outline-secondary text-dark",onClick:A}," 取消 "),e("button",{type:"submit",class:"btn btn-primary text-white px-5",disabled:x.value},[x.value?(s(),a("span",tt,[st,at,e("span",null,E(m.value?"儲存中":"新增中"),1)])):(s(),a("span",ot,E(m.value?"儲存":"新增"),1))],8,et)])],32)]))])])])],512)}}},it={class:"pt-3"},rt={class:"row"},ct=e("span",{class:"col-6"},[e("h3",{class:""},"活動列表")],-1),dt={class:"col-6"},ut={class:"float-end pe-3"},mt={class:"table-responsive"},_t={class:"table align-middle"},pt=e("thead",null,[e("tr",{class:"fw-500"},[e("td",null,"編碼"),e("td",null,"主標題"),e("td",null,"活動時間"),e("td",null,"狀態"),e("td",null,"操作")])],-1),ht=e("td",null,"wqeqwe",-1),vt={key:0,class:"text-success"},ft={key:1,class:"text-danger"},bt={class:"d-flex align-items-center"},gt=["onClick"],yt=["disabled","onClick"],wt={key:0},xt=e("span",{class:"spinner-grow spinner-grow-sm me-1","aria-hidden":"true"},null,-1),Ct=e("span",{role:"status"},null,-1),$t=e("span",null,"刪除中",-1),kt=[xt,Ct,$t],Ut={key:1},qt={__name:"AdminEventsView",setup(I){const D=ie(),{showAlert:y}=K(),M=W(),L=d(null),f=d([]),m=d(""),k=({type:h,id:t})=>{L.value.openModal({type:h,id:t})},w=async()=>{try{M.toggleLoading();const t=await S.get("https://vue-mu-ri-homeware-json-server.onrender.com/events");f.value=t.data}catch(h){y({title:"失敗",text:`${h.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}).then(t=>{t.isConfirmed&&D.replace("/admin")})}finally{M.toggleLoading()}},x=async h=>{try{y({title:"確認刪除訂單?",text:"注意：確認刪除後，訂單將無法復原!",icon:"question",confirmButtonColor:"#29292D",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,reverseButtons:!0,preConfirm:async()=>{try{return m.value=h,await S.delete()}catch(t){return y({title:"失敗",text:`${t.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}),!1}},allowOutsideClick:()=>!de.isLoading()}).then(async t=>{var c,C,O,l;(C=(c=t==null?void 0:t.value)==null?void 0:c.data)!=null&&C.success&&(y({position:"top-start",title:`成功 | ${(l=(O=t==null?void 0:t.value)==null?void 0:O.data)==null?void 0:l.message}`,icon:"success",showConfirmButton:!1,timer:1e3}),setTimeout(()=>{w()},1e3))})}catch(t){y({title:"失敗",text:`${t.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1})}finally{m.value=""}};return J(()=>{w()}),(h,t)=>(s(),a("div",it,[e("div",rt,[ct,e("span",dt,[e("div",ut,[e("button",{type:"button",class:"btn btn-success px-4",onClick:t[0]||(t[0]=c=>k({type:"create"}))}," 新增活動 ")])])]),e("div",mt,[e("table",_t,[pt,e("tbody",null,[(s(!0),a(re,null,ce(f.value,c=>(s(),a("tr",{key:c.id},[e("td",null,E(c.id),1),e("td",null,E(c.title),1),ht,e("td",null,[c.isPublic?(s(),a("span",vt," 啟用 ")):(s(),a("span",ft,"未啟用"))]),e("td",null,[e("div",bt,[e("button",{type:"button",class:"btn btn-outline-dark me-1",onClick:C=>k({type:"edit",id:c.id})}," 編輯 ",8,gt),e("button",{type:"button",class:"btn btn-outline-danger",disabled:m.value===c.id,onClick:C=>x(c.id)},[m.value===c.id?(s(),a("span",wt,kt)):(s(),a("span",Ut," 刪除 "))],8,yt)])])]))),128))])])]),v(nt,{ref_key:"adminEventModal",ref:L,onRefetchEvents:w},null,512)]))}};export{qt as default};

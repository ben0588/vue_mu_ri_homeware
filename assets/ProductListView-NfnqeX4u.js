import{r as u,q as y,z as D,p as O,c as s,u as d,b as c,e as p,h as L,A as T,F as _,f as h,l as f,d as N,x as U,o,t as R,y as E,a as F}from"./index-wONQE6OV.js";import{V as M}from"./index-ENWe5MEy.js";import{_ as j}from"./PaginationComponent-m2HiFVTu.js";import{_ as q}from"./HomeCard-yYwoMNk5.js";import{c as z}from"./RatingStar-MmqteJYn.js";import{u as K}from"./loadingStores-3OME-DdW.js";import{u as G}from"./categoryStores-X_s5eOmp.js";import{u as H}from"./searchStores-ZS78h76v.js";import"./usePriceToTw-mhH8eMrj.js";import"./wishStores-wSSplIBN.js";import"./useToast-0ZbpUez5.js";import"./useComputedDiscount-AukIehuS.js";const I={key:0,class:"container pb-32"},J={class:"row border-bottom border-2 my-2 py-2"},Q={class:"col-12 col-lg-10"},W={class:"row flex-row-reverse flex-md-row align-items-center justify-content-start"},X={class:"col-2 col-md-1 px-0"},Y={class:"col-4 col-md-3 ps-0 pe-lg-0"},Z=c("option",{value:"",selected:"",disabled:""},"請選擇主類型",-1),ee=["value"],te={key:0},ae={key:1},se={class:"col-6 col-md-4 pe-1 pe-md-0"},oe=["value","selected"],re={key:0,class:"col-12 col-md-4 ps-1 ps-lg-12 mt-2 mt-md-0"},ce={key:0,class:"row mt-4"},le={key:1,class:"pt-3"},ie={key:2,class:"flex-center mt-3 pt-3"},we={__name:"ProductListView",setup(ne){const l=G(),g=K(),m=H(),{showAlert:C}=E(),v=u([]),x=u([]),V=u(""),i=u("default"),P="https://vue3-course-api.hexschool.io",$="vue-ben0588",n=async(r=1,e="")=>{try{g.toggleLoading();const t=`${P}/v2/api/${$}/products?page=${r}&category=${e}`,a=await U.get(t);v.value=a.data.products,x.value=a.data.pagination}catch(t){C({title:"失敗",text:`${t.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}finally{g.toggleLoading()}},b=y(()=>z(v.value)),A=y(()=>[{id:"0",text:"全部商品"},{id:"1",text:"特價中"},{id:"2",text:"家具"},{id:"3",text:"家飾"},{id:"4",text:"燈具"},{id:"5",text:"廚房用品"},{id:"6",text:"浴室用品"},{id:"7",text:"寢具"},{id:"8",text:"收納"},{id:"9",text:"戶外與園藝"},{id:"10",text:"辦公室用品"},{id:"11",text:"孩童家居"}]),B=u([{id:0,title:"排序：默認",command:"default"},{id:1,title:"排序：推薦",command:"recommend"},{id:2,title:"排序：特價",command:"sale"},{id:3,title:"排序：評價高到低",command:"comments"},{id:4,title:"排序：價格低到高",command:"price_small"},{id:5,title:"排序：價格高到低",command:"price_big"},{id:6,title:"排序：建立產品新到舊",command:"create_date_new"},{id:7,title:"排序：建立產品舊到新",command:"create_date_old"}]),w=y(()=>{let r=b.value.slice();switch(i.value){case"default":r=b.value.slice();break;case"recommend":r.sort((e,t)=>{if(e.isRecommended&&!t.isRecommended)return-1;if(!e.isRecommended&&t.isRecommended)return 1;const a=t.starSymbols.fullStars-e.starSymbols.fullStars;if(a!==0)return a;const k=t.totalRatings-e.totalRatings;return k!==0?k:new Date(t.create_date)-new Date(e.create_date)});break;case"comments":r.sort((e,t)=>{const a=t.starSymbols.fullStars-e.starSymbols.fullStars;return a!==0?a:t.totalRatings-e.totalRatings});break;case"sale":r.sort((e,t)=>e.isOnSale&&!t.isOnSale?-1:!e.isOnSale&&t.isOnSale?1:new Date(t.create_date)-new Date(e.create_date));break;case"price_small":r.sort((e,t)=>e.price-t.price);break;case"price_big":r.sort((e,t)=>t.price-e.price);break;case"create_date_new":r.sort((e,t)=>new Date(t.create_date)-new Date(e.create_date));break;case"create_date_old":r.sort((e,t)=>new Date(e.create_date)-new Date(t.create_date));break}return r}),S=()=>{l.categoryTarget="全部商品",V.value="",i.value="default",m.isSearch=!1,m.searchText="",n()};return D(()=>l.categoryTarget,()=>{l.categoryTarget==="全部商品"?(i.value="default",n(1,"")):l.categoryTarget==="特價中"?(i.value="sale",n(1,"")):(i.value="default",n(1,l.categoryTarget))}),O(()=>{l.categoryTarget==="全部商品"?n():l.categoryTarget==="特價中"?(i.value="sale",n(1,"")):n(1,l.categoryTarget)}),D(()=>m.productsList,()=>{const r=m.productsList.map(e=>e.item);v.value=r}),(r,e)=>{const t=F("font-awesome-icon");return o(),s(_,null,[d(g).isLoading?f("",!0):(o(),s("div",I,[c("span",J,[c("div",Q,[c("div",W,[c("div",X,[c("button",{type:"button",class:"btn border border-1 d-inline reset-btn ms-2 ms-lg-0 me-lg-2",title:"重置選擇",onClick:S},[p(t,{icon:["fas","rotate"],class:""})])]),c("div",Y,[L(c("select",{class:"products-select-rwd form-select d-inline ms-2 ms-lg-0 me-lg-2","aria-label":"Default select example","onUpdate:modelValue":e[0]||(e[0]=a=>d(l).categoryTarget=a)},[Z,(o(!0),s(_,null,h(A.value,a=>(o(),s("option",{value:a.text,key:a.id},[a.text==="特價中"?(o(),s("span",te,"全部商品(特價)")):(o(),s("span",ae,R(a.text),1))],8,ee))),128))],512),[[T,d(l).categoryTarget]])]),c("div",se,[L(c("select",{class:"products-select-rwd form-select d-inline ms-lg-0","aria-label":"Default select example","onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a)},[(o(!0),s(_,null,h(B.value,a=>(o(),s("option",{value:a.command,key:a.id,selected:a.command==="create_date"},R(a.title),9,oe))),128))],512),[[T,i.value]])]),d(m).isSearch?(o(),s("div",re,[d(m).isSearch?(o(),s("button",{key:0,type:"button",class:"btn btn-warning border border-1 d-inline reset-btn ms-2 ms-lg-0 me-lg-2",title:"重置關鍵字搜尋",onClick:S}," 重置關鍵字搜尋 ")):f("",!0)])):f("",!0)])])]),w.value.length!==0?(o(),s("div",ce,[(o(!0),s(_,null,h(w.value,a=>(o(),s("div",{class:"col-sm-6 col-md-4 col-lg-3 mb-3",key:a.id},[p(q,{product:a,"img-class":"products-card-img"},null,8,["product"])]))),128))])):(o(),s("div",le,[c("p",null,[p(t,{icon:["fas","circle-exclamation"],class:"text-danger me-2"}),N("您輸入的關鍵字找不到相關商品，請嘗試其他關鍵字，或使用類別查看商品。謝謝 ")])])),d(m).isSearch?f("",!0):(o(),s("div",ie,[p(j,{pagination:x.value,"onUpdated:page":n},null,8,["pagination"])]))])),p(d(M),{active:d(g).isLoading,"can-cancel":!1,color:"#0089A7"},null,8,["active"])],64)}}};export{we as default};

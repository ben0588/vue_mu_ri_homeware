import{r as m,p as K,C as U,a as N,o as n,c as d,b as e,h as A,v as j,e as o,d as i,F as T,f as O,t as c,x as G,_ as P,q as Q,u as t,g as q,l as V,$ as W,n as z,a0 as Z,a1 as J,y as X}from"./index-wONQE6OV.js";import{V as Y}from"./index-ENWe5MEy.js";import{c as ee,a as B}from"./index.esm-o1ODu1jD.js";import{u as _}from"./usePriceToTw-mhH8eMrj.js";import{u as se}from"./useComputedDiscount-AukIehuS.js";import{u as te}from"./cartStores-vRrvGi1h.js";import{_ as F}from"./VeeValidateInput-GRKxhBP6.js";import{M as oe}from"./bootstrap.esm-FzNOyMo5.js";import{u as ce}from"./useToast-0ZbpUez5.js";const ae={class:"modal-dialog"},le={class:"modal-content border-0"},ne=e("h5",{id:"frontCModalLabel",class:"modal-title"},"使用優惠卷",-1),de={class:"modal-body"},re={class:"input-group mb-3"},ie={class:"form-floating"},ue=["disabled"],_e=e("label",{for:"floatingInput"},"輸入優惠卷代碼",-1),pe=["disabled"],me={class:"border border-2 p-3"},he={class:"fs-5 border-bottom border-dark pb-2 mb-2"},fe={class:"mb-0 py-3"},be={class:"row align-items-center"},ve={class:"col-6"},ge={class:"col-6"},xe={class:"input-group"},we=["value"],ye=["onClick"],ke={__name:"CouponModal",emits:["refetch-carts"],setup(H,{expose:l,emit:k}){const b=m(null),p=m(null),u=m(""),v=m(!1),{toastAlert:y}=ce(),M=m([{id:0,title:"新會員折扣優惠",center:"7折",code:"new7",percentage:"70%"},{id:1,title:"舊會員折扣優惠",center:"95折",code:"old95",percentage:"95%"},{id:2,title:"回饋會員 85折",center:"85折",code:"sale85",percentage:"85%"},{id:3,title:"回饋會員 82折",center:"82折",code:"sale82",percentage:"82%"}]),L=k;K(()=>{p.value=new oe(b.value)}),U(()=>{p.value&&p.value.dispose()});const E=()=>{p.value.show()},C=()=>{p.value.hide()},S=h=>{navigator.clipboard.writeText(h).then(()=>{y({message:`<img src="https://cdn-icons-gif.flaticon.com/8948/8948314.gif" class="success-icon" alt="icon樣式"/><a href="https://www.flaticon.com/free-animated-icons/document" title="document animated icons" class="d-none">Document animated icons created by Freepik - Flaticon</a> 複製代碼成功：${h}`,transition:"slide"})})},R=async()=>{try{v.value=!0;const g=await G.post("https://vue3-course-api.hexschool.io/v2/api/vue-ben0588/coupon",{data:{code:u.value}});g.data.success&&(y({message:`<img src="https://cdn-icons-gif.flaticon.com/10970/10970392.gif" class="success-icon" alt="icon樣式"/><a href="https://www.flaticon.com/free-animated-icons/success" title="success animated icons" class="d-none">Success animated icons created by Freepik - Flaticon</a>${g.data.message}`,transition:"slide"}),u.value="",setTimeout(()=>{L("refetch-carts",!0),C()},1e3))}catch(h){y({message:`<img src="https://cdn-icons-gif.flaticon.com/11257/11257124.gif" class="success-icon"  alt="icon樣式"/><a href="https://www.flaticon.com/free-animated-icons/error" title="error animated icons" class="d-none">Error animated icons created by Freepik - Flaticon</a>${h.response.data.message}`,transition:"slide"}),u.value=""}finally{v.value=!1,u.value=""}};return l({openModal:E,closeModal:C}),(h,g)=>{const x=N("font-awesome-icon");return n(),d("div",{class:"modal fade",tabindex:"-1","aria-labelledby":"frontCModalLabel","aria-hidden":"true",ref_key:"bsFrontCouponModalRef",ref:b},[e("div",ae,[e("div",le,[e("div",{class:"modal-header bg-dark text-white"},[ne,e("button",{type:"button",class:"bg-dark text-white fs-4 fw-bolder border-0","data-bs-dismiss":"modal","aria-label":"Close",onClick:C}," X ")]),e("div",de,[e("div",re,[e("div",ie,[A(e("input",{type:"email",class:"form-control",id:"floatingInput",placeholder:"輸入您的優惠卷代碼","onUpdate:modelValue":g[0]||(g[0]=r=>u.value=r),disabled:v.value},null,8,ue),[[j,u.value,void 0,{trim:!0}]]),_e]),e("button",{class:"btn btn-secondary",type:"button",disabled:u.value===""||v.value,onClick:R}," 使用 ",8,pe)]),e("div",me,[e("p",he,[o(x,{icon:["far","calendar"]}),i(" 「超值特惠」現正舉辦中！ ")]),e("ul",fe,[(n(!0),d(T,null,O(M.value,r=>(n(),d("li",{key:r.id,class:"pb-2"},[e("div",be,[e("div",ve,c(r.title)+"|["+c(r.center)+"]",1),e("div",ge,[e("div",xe,[e("input",{type:"text",class:"form-control",readonly:"",value:r.code},null,8,we),e("button",{class:"btn btn-secondary",type:"button",onClick:$=>S(r.code)}," 複製 ",8,ye)])])])]))),128))])])])])])],512)}}},Ce={key:0,class:"container"},$e={key:0},Be={class:"table-responsive border-start border-end border-top border-2 border-dark px-3 pt-3"},Fe={class:"fs-5 border-bottom border-dark pb-2 mb-3"},Te={class:"table align-middle"},Me=e("thead",null,[e("tr",null,[e("td",{class:"text-start",colspan:"3"},"商品明細"),e("td",null,"售價"),e("td",{class:"text-center"},"數量"),e("td",{class:"text-end pe-3"},"小計")])],-1),Le={class:"cart-img-container"},Ee=["src","alt"],Se={class:"cart-sale-tag"},Re={class:"position-relative"},qe={class:"arrow-animation-container"},Ve=e("td",{class:"order-phone-td"},null,-1),Ne={class:"d-flex flex-column justify-content-center"},Oe={class:"text-decoration-line-through text-muted ms-1"},De={class:"fw-500 fs-5 text-danger"},Ae={class:"text-center"},je={class:"text-end pe-3"},Ge={key:0,class:"d-flex flex-column justify-content-end"},He={class:"text-decoration-line-through text-muted"},Ie={class:"fw-500 fs-5 text-danger"},Ke={class:"fw-500 fs-6 text-danger"},Ue={key:1},Pe={class:"border-start border-end border-bottom border-2 border-dark mb-3"},Qe={class:"d-flex justify-content-end pb-12 pe-3"},We={class:"d-flex flex-column align-items-end"},ze={class:"fs-5"},Ze={class:"fw-700"},Je=e("span",{class:"text-muted"},"*未含運費",-1),Xe={key:1,class:"row flex-column-reverse flex-lg-row"},Ye={class:"col-lg-6"},es={class:"border border-2 border-dark p-3 mt-3 mt-lg-0"},ss=["onSubmit"],ts={class:"fs-5 border-bottom border-dark pb-2 mb-3"},os=["disabled"],cs={key:0},as=e("span",{class:"spinner-grow spinner-grow-sm me-1","aria-hidden":"true"},null,-1),ls=e("span",{role:"status"},null,-1),ns={key:1},ds={class:"border border-2 border-dark p-3 mt-3 mt-lg-0"},rs={class:"mb-3"},is={for:"order-message",class:"form-label fs-5 border-bottom border-dark w-100 pb-2 mb-3"},us={class:"border border-2 border-dark p-3 mt-3"},_s={class:"fs-5 border-bottom border-dark pb-2 mb-3"},ps=W('<div class="border border-2 border-dark p-3"><div class="row justify-content-between align-items-center"><div class="col-sm-9"><div><h5>宅配-一般家飾</h5><p class="mb-0">費運120元，商品金額滿100元免運</p><p>(期間限定：2023/01/01~2024/12/31)</p></div></div><div class="col-sm-3"><p class="fs-3 fw-700 mb-0">$ 120</p></div></div></div>',1),ms={class:"col-lg-6"},hs={class:"border border-2 border-dark p-3"},fs={class:"fs-5 border-bottom border-dark pb-2 mb-3"},bs={class:"d-flex justify-content-between align-content-center"},vs={class:"border-bottom border-dark"},gs={class:"row pb-3"},xs=e("div",{class:"col-lg-2"},null,-1),ws={class:"col-lg-10"},ys={class:"row"},ks=e("div",{class:"col-0 col-sm-4 col-md-6 col-lg-3"},null,-1),Cs=e("div",{class:"col-6 col-sm-4 col-md-3 col-lg-6"},"商品總金額",-1),$s={class:"col-6 col-sm-4 col-md-3 col-lg-3 text-end"},Bs=e("div",{class:"col-0 col-sm-4 col-md-6 col-lg-3"},null,-1),Fs=e("div",{class:"col-6 col-sm-4 col-md-3 col-lg-6"},"運費小計",-1),Ts={class:"col-6 col-sm-4 col-md-3 col-lg-3 text-end text-decoration-line-through"},Ms={class:"text-muted"},Ls={key:0,class:"row"},Es={class:"col-0 col-sm-4 col-md-6 col-lg-3 text-danger text-start text-sm-end"},Ss={class:"col-6 col-sm-4 col-md-3 col-lg-6 text-danger"},Rs={class:"col-6 col-sm-4 col-md-3 col-lg-3 text-danger text-end"},qs={key:1,class:"row"},Vs=e("div",{class:"col-0 col-sm-4 col-md-6 col-lg-3"},null,-1),Ns={class:"col-6 col-sm-4 col-md-3 col-lg-6"},Os=e("div",{class:"col-6 col-sm-4 col-md-3 col-lg-3 text-end"},"未使用",-1),Ds={class:"row"},As=e("div",{class:"col-lg-3"},null,-1),js={class:"col-lg-9"},Gs={class:"row pt-3"},Hs=e("div",{class:"col-0 col-sm-4 col-md-6 col-lg-2"},null,-1),Is=e("div",{class:"col-6 col-sm-4 col-md-3 col-lg-6"},[e("div",{class:"fs-5 fw-700"},"訂單最終總金額")],-1),Ks={class:"col-6 col-sm-4 col-md-3 col-lg-4 text-end"},Us={class:"fs-5 fw-700"},Ps={class:"mt-3"},Qs={class:"border border-2 border-dark p-3"},Ws={class:"fs-5 border-bottom border-dark pb-2 mb-3"},zs={class:"w-100"},Zs={key:2,class:"flex-center flex-column"},Js={class:"fs-4 mb-4"},Xs=e("div",null,[e("img",{src:"https://storage.googleapis.com/vue-course-api.appspot.com/vue-ben0588/1709523797457.png?GoogleAccessId=firebase-adminsdk-zzty7%40vue-course-api.iam.gserviceaccount.com&Expires=1742169600&Signature=TVpfq289hPAS0eJEUfUdQ094vN5dKwHD%2B261x5OpEH1uHeeE0Nd99HygcwvSAOfHcQJ4%2F%2B9BK4ugP20MZHg4sW9yksSFesbZoGYe6mOP3%2FLGJYD%2BwUyH3Go3d544OviGcMSRW%2FzcR1RKaWsMH1JEKdqCXibbCmwjqmnGufKB%2FeMqTzm3u8%2Fa66DIcFfmJf4t4%2BWdh2R5EQWzKN%2FVTud3sRRhiH%2BrltLOEoty5SBftDQnphuRO19cubaX2FaUG5ZpArGLvfPUgNu8lW9ivRIlaWgEqf36Mki4GOVn1cL2QV5lPje1jeZqN5oQjRZk1%2F52YRpaP7LcSt%2ByA%2FZEa0mnpQ%3D%3D",alt:"購物車目前並無任何商品",style:{width:"200px",height:"200px"}})],-1),Ys={class:"mt-4 w-100 text-center"},rt={__name:"OrderConfirmView",setup(H){const l=te(),{fetchCarts:k}=l,{showAlert:b}=X(),p=m(""),u=m(null),v=P(),y=m(""),M=m(["訂購有任何需要注意事項或備註項目，請先確保在建立訂單前填寫完畢，謝謝 !","在結帳前，請務必仔細核對您的訂單信息，確保一切正確無誤，以免因錯誤信息導致不必要的麻煩。","如果您在購物過程中遇到任何問題或需要幫助，請隨時聯繫我們的客戶支援團隊。","我們為您提供全面的售後服務，包括維修、保固等。您可以在購買後放心享受我們的售後支援。"]),L=/^(0|\+?886)9\d{8}$/,E=/^[\u4E00-\u9FA5]{2,4}$/,C=ee().shape({username:B().required("此欄位必填").matches(E,{message:"請輸入有效的中文姓名",excludeEmptyString:!0}),email:B().required("此欄位必填").email("請輸入正確email格式"),phone:B().matches(L,{message:"請輸入有效的台灣手機號碼",excludeEmptyString:!0}).required("手機號碼為必填欄位"),address:B().required("聯絡地址必填")}),S=Q(()=>(l.cartTotal-l.cartFinalTotal)/l.cartTotal*100);async function R(x){try{const r="https://vue3-course-api.hexschool.io/v2/api/vue-ben0588/order",$={user:{name:x.username,email:x.email,tel:x.phone,address:x.address},message:p.value};b({title:"建立訂單",text:"注意：確認建立後聯絡人資料異動須透過客服修改",icon:"question",confirmButtonColor:"#29292D",cancelButtonColor:"#b2bec3",confirmButtonText:"確認",cancelButtonText:"取消",showCancelButton:!0,showCloseButton:!0,showLoaderOnConfirm:!0,reverseButtons:!0,preConfirm:async()=>{try{return await G.post(r,{data:$})}catch(a){return b({title:"失敗",text:`${a.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1}),!1}},allowOutsideClick:()=>!J.isLoading()}).then(async a=>{var s,f;(f=(s=a==null?void 0:a.value)==null?void 0:s.data)!=null&&f.success&&(y.value=a.value.data.orderId,b({title:"成功",text:`${a.value.data.message}`,icon:"success",showCancelButton:!0,confirmButtonText:"前往付款",confirmButtonColor:"#000000",cancelButtonColor:"#b2bec3",cancelButtonText:"繼續逛逛",reverseButtons:!0,allowOutsideClick:!1,allowEscapeKey:!1}).then(w=>{w.isConfirmed?(v.replace({name:"front_order_payment",params:{id:y.value}}),k()):w.dismiss==="cancel"&&(v.replace({path:"/products"}),k())}))})}catch(r){b({title:"失敗!",text:`${r.response.data.message}`,icon:"error",confirmButtonText:"確認",confirmButtonColor:"#000000",allowEscapeKey:!1,allowOutsideClick:!1})}}const h=()=>{u.value.openModal()},g=()=>{k()};return(x,r)=>{const $=N("router-link"),a=N("font-awesome-icon");return n(),d(T,null,[t(l).cartLoading?V("",!0):(n(),d("div",Ce,[t(l).cartList.length?(n(),d("div",$e,[o($,{to:"/carts",class:"d-inline-block text-dark text-decoration-underline hover-opacity p-3",title:"返回購物車"},{default:q(()=>[i("返回上頁")]),_:1}),e("div",Be,[e("p",Fe,[o(a,{icon:["far","rectangle-list"]}),i(" 確認訂單 ")]),e("table",Te,[Me,e("tbody",null,[(n(!0),d(T,null,O(t(l).cartList,s=>(n(),d("tr",{key:s.id},[e("td",null,[e("div",Le,[e("img",{src:s.product.imageUrl,alt:s.product.title,class:"cart-img"},null,8,Ee),e("span",Se," -"+c(t(se)(s.product.origin_price,s.product.price)),1)])]),e("td",null,[e("div",Re,[e("div",null,c(s.product.title),1),e("div",null,c(s.product.description),1),e("div",null,"單位："+c(s.product.unit),1),e("div",qe,[o(a,{icon:["fas","angles-right"],class:"fs-1"})])])]),Ve,e("td",null,[e("div",Ne,[e("span",Oe,c(t(_)(s.product.origin_price)),1),e("span",De,c(t(_)(s.product.price)),1)])]),e("td",Ae,c(s.qty),1),e("td",je,[s.coupon?(n(),d("div",Ge,[e("span",He,c(t(_)(s.total)),1),e("span",null,[e("span",Ie,c(t(_)(s.final_total)),1)]),e("span",Ke,[o(a,{icon:["fas","ticket-simple"]}),i(" 已折 "),e("span",null,c(s.coupon.code),1)])])):s.coupon?V("",!0):(n(),d("div",Ue,[e("span",null,c(t(_)(s.total)),1)]))])]))),128))])])]),e("div",Pe,[e("div",Qe,[e("div",We,[e("span",ze,[e("span",null," 共 "+c(t(l).cartList.length)+" 項商品 | ",1),e("span",Ze," 合計 NT"+c(t(_)(t(l).cartTotal)),1)]),Je])])])])):V("",!0),t(l).cartList.length?(n(),d("div",Xe,[e("div",Ye,[e("div",es,[o(t(Z),{"validation-schema":t(C),as:"div"},{default:q(({handleSubmit:s,isSubmitting:f,errors:w,meta:D})=>[e("form",{onSubmit:I=>s(I,R)},[e("p",ts,[o(a,{icon:["far","address-card"]}),i(" 訂購人資料 ")]),o(F,{name:"username",label:"訂購人姓名",id:"order-username",placeholder:"請輸入訂購人姓名",errors:w,type:"text"},null,8,["errors"]),o(F,{name:"phone",label:"聯絡手機",id:"order-phone",placeholder:"請輸入聯絡手機",errors:w,type:"tel"},null,8,["errors"]),o(F,{name:"email",label:"聯絡信箱 [ 訂單通知、電子發票寄送 ]",id:"order-email",placeholder:"請輸入聯絡電子信箱",errors:w,type:"email"},null,8,["errors"]),o(F,{name:"address",label:"地址",id:"order-address",placeholder:"請輸入寄送地址",errors:w,type:"text"},null,8,["errors"]),e("button",{type:"submit",class:z(["btn btn-dark w-100",`${!D.valid||f?"cursor-not-allowed":""}`]),disabled:!D.valid||f},[f?(n(),d("span",cs,[as,ls,i(" 建立訂單中 ")])):(n(),d("span",ns,"建立訂單"))],10,os)],40,ss)]),_:1},8,["validation-schema"])]),e("div",ds,[e("div",rs,[e("label",is,[o(a,{icon:["far","pen-to-square"]}),i(" 訂單備註/告知客服內容")]),A(e("textarea",{name:"message",id:"order-message",cols:"30",rows:"5",placeholder:"若您的配送地點可能有道路、樓梯間、戶門狹窄而無法駛入或搬入的問題，請在訂單留言",class:"form-control","onUpdate:modelValue":r[0]||(r[0]=s=>p.value=s)},null,512),[[j,p.value,void 0,{trim:!0}]])])]),e("div",us,[e("p",_s,[o(a,{icon:["fas","truck-fast"]}),i(" 運輸方式 ")]),ps])]),e("div",ms,[e("div",hs,[e("div",fs,[e("div",bs,[e("span",null,[o(a,{icon:["fas","ticket"]}),i(" 優惠卷")]),e("span",null,[e("button",{type:"button",class:"btn btn-primary text-white px-3",onClick:h}," 選擇優惠卷 ")])])]),e("div",vs,[e("div",gs,[xs,e("div",ws,[e("div",ys,[ks,Cs,e("div",$s,c(t(_)(t(l).cartTotal)),1),Bs,Fs,e("div",Ts,[e("span",Ms,c(t(_)(0)),1)])]),t(l).cartList[0].coupon?(n(),d("div",Ls,[e("div",Es," - "+c(Math.floor(S.value))+" % ",1),e("div",Ss,[o(a,{icon:["fas","ticket-simple"]}),i(" 折價卷折抵 ")]),e("div",Rs,c(t(_)(t(l).cartFinalTotal-t(l).cartTotal)),1)])):(n(),d("div",qs,[Vs,e("div",Ns,[o(a,{icon:["fas","ticket-simple"]}),i(" 折價卷折抵 ")]),Os]))])])]),e("div",Ds,[As,e("div",js,[e("div",Gs,[Hs,Is,e("div",Ks,[e("span",Us,"NT"+c(t(_)(t(l).cartFinalTotal)),1)])])])])]),e("div",Ps,[e("div",Qs,[e("p",Ws,[o(a,{icon:["fas","circle-exclamation"]}),i(" 訂購注意事項 ")]),e("ul",zs,[(n(!0),d(T,null,O(M.value,(s,f)=>(n(),d("li",{key:f,class:"mb-2"},c(s),1))),128))])])])])])):(n(),d("div",Zs,[e("p",Js,[o(a,{icon:["fas","circle-exclamation"],class:"text-danger me-2"}),i("購物車目前並無任何商品 ")]),Xs,e("div",Ys,[o($,{to:"/products",class:"btn btn-dark px-64"},{default:q(()=>[i("前去逛逛")]),_:1})])]))])),o(t(Y),{active:t(l).cartLoading,"can-cancel":!1,color:"#0089A7"},null,8,["active"]),o(ke,{ref_key:"couponModal",ref:u,onRefetchCarts:g},null,512)],64)}}};export{rt as default};
